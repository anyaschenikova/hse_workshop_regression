schema: '2.0'
stages:
  load_data:
    cmd: python -m src.data.make_dataset --config=params.yaml
    deps:
    - path: data/raw/test.csv
      md5: dcec4b79bf9c7317bd9e17789bf888f0
      size: 451405
    - path: data/raw/train.csv
      md5: 80ccab65fb115cbad143dbbd2bcd5577
      size: 460676
    - path: src/config.py
      md5: c0367088af98430432688ef14798ad96
      size: 2552
    - path: src/data/make_dataset.py
      md5: b6a4d95ff4015fef8bf682d13cb07e1a
      size: 1184
    - path: src/data/preprocess.py
      md5: 6416cd23173ab67fca6cba1b83d429cb
      size: 1043
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 375
    params:
      params.yaml:
        load_data:
          data_train_path: data/raw/train.csv
          data_test_path: data/raw/test.csv
        preprocess_data:
          cols:
            TARGET_COL: SalePrice
            ID_COL: Id
            REAL_COLS:
            - MSSubClass
            - LotFrontage
            - LotArea
            - OverallQual
            - OverallCond
            - YearBuilt
            - YearRemodAdd
            - MasVnrArea
            - BsmtFinSF1
            - BsmtFinSF2
            - BsmtUnfSF
            - TotalBsmtSF
            - 1stFlrSF
            - 2ndFlrSF
            - LowQualFinSF
            - GrLivArea
            - BsmtFullBath
            - BsmtHalfBath
            - FullBath
            - HalfBath
            - BedroomAbvGr
            - KitchenAbvGr
            - TotRmsAbvGrd
            - Fireplaces
            - GarageYrBlt
            - GarageCars
            - GarageArea
            - WoodDeckSF
            - OpenPorchSF
            - EnclosedPorch
            - 3SsnPorch
            - ScreenPorch
            - PoolArea
            - MiscVal
            - MoSold
            - YrSold
            CAT_COLS:
            - MSZoning
            - Street
            - Alley
            - LotShape
            - LandContour
            - Utilities
            - LotConfig
            - LandSlope
            - Neighborhood
            - Condition1
            - Condition2
            - BldgType
            - HouseStyle
            - RoofStyle
            - RoofMatl
            - Exterior1st
            - Exterior2nd
            - MasVnrType
            - ExterQual
            - ExterCond
            - Foundation
            - BsmtQual
            - BsmtCond
            - BsmtExposure
            - BsmtFinType1
            - BsmtFinType2
            - Heating
            - HeatingQC
            - CentralAir
            - Electrical
            - KitchenQual
            - Functional
            - FireplaceQu
            - GarageType
            - GarageFinish
            - GarageQual
            - GarageCond
            - PavedDrive
            - PoolQC
            - Fence
            - MiscFeature
            - SaleType
            - SaleCondition
          paths:
            preprocessed_train_data_pkl: data/interim/train_data.pkl
            preprocessed_target_data_pkl: data/interim/target_data.pkl
            preprocessed_test_data_pkl: data/interim/test_data.pkl
    outs:
    - path: data/interim/test_data.pkl
      md5: 0d9a821ba9e8df33b8a92016065c3b77
      size: 505522
    - path: data/interim/train_data.pkl
      md5: 223d0baf1ca19913f2fd1dab9a2dcabf
      size: 517727
  generate_features:
    cmd: python -m src.features.build_features --config=params.yaml
    deps:
    - path: data/interim/test_data.pkl
      md5: 0d9a821ba9e8df33b8a92016065c3b77
      size: 505522
    - path: data/interim/train_data.pkl
      md5: 223d0baf1ca19913f2fd1dab9a2dcabf
      size: 517727
    - path: src/config.py
      md5: c0367088af98430432688ef14798ad96
      size: 2552
    - path: src/features/build_features.py
      md5: 8e439f7f77fb7c8daaa41c3d5c1d47bf
      size: 1232
    - path: src/features/features.py
      md5: dee555a1230b989fa0ef038b95c9f638
      size: 445
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 375
    params:
      params.yaml:
        generate_features:
          cols:
            YEAR_SOLD: YrSold
            YEAR_BUILT: YearBuilt
            BUILDING_AGE: BuildingAge
          paths:
            featurized_train_data_pkl: data/interim/featurized_train_data_pkl
            featurized_test_data_pkl: data/interim/featurized_test_data_pkl
    outs:
    - path: data/interim/featurized_test_data_pkl
      md5: 0d9a821ba9e8df33b8a92016065c3b77
      size: 505522
    - path: data/interim/featurized_train_data_pkl
      md5: 223d0baf1ca19913f2fd1dab9a2dcabf
      size: 517727
  train_catboost:
    cmd: python -m src.models.catboost.train_model --config=params.yaml
    deps:
    - path: data/interim/featurized_train_data_pkl
      md5: 223d0baf1ca19913f2fd1dab9a2dcabf
      size: 517727
    - path: src/config.py
      md5: c0367088af98430432688ef14798ad96
      size: 2552
    - path: src/models/catboost/train_model.py
      md5: 8e58dee394ae2c53332720084ba75ad3
      size: 1674
    - path: src/models/utils.py
      md5: 7ae8f6b833ba2e35fd353c67aa8c400e
      size: 554
    params:
      params.yaml:
        train_models:
          train_test_split_train_size: 0.8
          paths:
            hyperopt_best_model_path: models/hyperopt_best_model.joblib
            catboost_best_model_path: models/catboost_best_model.joblib
          hyperopt:
            max_evals: 50
            trial_timeout: 30
          catboost:
            iterations: 1000
            learning_rate: 0.02
            eval_metric: R2
    outs:
    - path: catboost_info/learn_error.tsv
      md5: 8be121a6fb8721143a9ae7cec2987711
      size: 28679
    - path: models/catboost_best_model.joblib
      md5: 4f8b7142a2eb57e8892428cfaec45842
      size: 1196344
  train_hyperopt:
    cmd: python -m src.models.hyperopt.train_model --config=params.yaml
    deps:
    - path: data/interim/featurized_train_data_pkl
      md5: 223d0baf1ca19913f2fd1dab9a2dcabf
      size: 517727
    - path: src/config.py
      md5: c0367088af98430432688ef14798ad96
      size: 2552
    - path: src/models/hyperopt/find_best_model.py
      md5: 6d07748c1893a652aa8599a38acd7fd9
      size: 654
    - path: src/models/hyperopt/pipelines.py
      md5: ff1f9c955e0c585800d91e2684ce0849
      size: 409
    - path: src/models/hyperopt/train_model.py
      md5: eb2884db0f66a9721812ff442edbbc3c
      size: 1685
    - path: src/models/utils.py
      md5: 7ae8f6b833ba2e35fd353c67aa8c400e
      size: 554
    params:
      params.yaml:
        train_models:
          train_test_split_train_size: 0.8
          paths:
            hyperopt_best_model_path: models/hyperopt_best_model.joblib
            catboost_best_model_path: models/catboost_best_model.joblib
          hyperopt:
            max_evals: 50
            trial_timeout: 30
          catboost:
            iterations: 1000
            learning_rate: 0.02
            eval_metric: R2
    outs:
    - path: models/hyperopt_best_model.joblib
      md5: 3b5d9881f51a9a567bd9677993f310f6
      size: 2308554
  pred_eval_hyperopt:
    cmd: python -m src.models.hyperopt.predict_n_eval_model --config=params.yaml
    deps:
    - path: data/interim/featurized_test_data_pkl
      md5: 0d9a821ba9e8df33b8a92016065c3b77
      size: 505522
    - path: data/interim/featurized_train_data_pkl
      md5: 223d0baf1ca19913f2fd1dab9a2dcabf
      size: 517727
    - path: models/hyperopt_best_model.joblib
      md5: 3b5d9881f51a9a567bd9677993f310f6
      size: 2308554
    - path: src/config.py
      md5: c0367088af98430432688ef14798ad96
      size: 2552
    - path: src/models/hyperopt/predict_n_eval_model.py
      md5: 20808b960458c056890b89f07f1d6863
      size: 1659
    - path: src/models/hyperopt/train_model.py
      md5: eb2884db0f66a9721812ff442edbbc3c
      size: 1685
    - path: src/models/predict_n_eval_utils.py
      md5: 4dd99ed85e2fd5047758abd56adbaa5a
      size: 383
    - path: src/models/utils.py
      md5: 7ae8f6b833ba2e35fd353c67aa8c400e
      size: 554
    params:
      params.yaml:
        predict_n_eval:
          hyperopt:
            metrics: reports/hyperopt_metrics.json
            inference_predict: data/processed/hyperopt_predict.csv
          catboost:
            metrics: reports/catboost_metrics.json
            inference_predict: data/processed/catboost_predict.csv
    outs:
    - path: data/processed/hyperopt_predict.csv
      md5: 834c3c412382d18a6ebc3bf64eeba96e
      size: 36475
    - path: reports/hyperopt_metrics.json
      md5: 3d01f86bbd974fd32ce5f435320ee270
      size: 98
  pred_eval_catboost:
    cmd: python -m src.models.catboost.predict_n_eval_model --config=params.yaml
    deps:
    - path: data/interim/featurized_test_data_pkl
      md5: 0d9a821ba9e8df33b8a92016065c3b77
      size: 505522
    - path: data/interim/featurized_train_data_pkl
      md5: 223d0baf1ca19913f2fd1dab9a2dcabf
      size: 517727
    - path: models/catboost_best_model.joblib
      md5: 4f8b7142a2eb57e8892428cfaec45842
      size: 1196344
    - path: src/config.py
      md5: c0367088af98430432688ef14798ad96
      size: 2552
    - path: src/models/catboost/predict_n_eval_model.py
      md5: ab4b85b71a31e507814c317cd2045391
      size: 1649
    - path: src/models/catboost/train_model.py
      md5: 8e58dee394ae2c53332720084ba75ad3
      size: 1674
    - path: src/models/predict_n_eval_utils.py
      md5: 4dd99ed85e2fd5047758abd56adbaa5a
      size: 383
    - path: src/models/utils.py
      md5: 7ae8f6b833ba2e35fd353c67aa8c400e
      size: 554
    params:
      params.yaml:
        predict_n_eval:
          hyperopt:
            metrics: reports/hyperopt_metrics.json
            inference_predict: data/processed/hyperopt_predict.csv
          catboost:
            metrics: reports/catboost_metrics.json
            inference_predict: data/processed/catboost_predict.csv
    outs:
    - path: data/processed/catboost_predict.csv
      md5: 803bc34582b007d469b071650bea8a44
      size: 36475
    - path: reports/catboost_metrics.json
      md5: 4131444ec03d57dda641277324ed93e8
      size: 99
